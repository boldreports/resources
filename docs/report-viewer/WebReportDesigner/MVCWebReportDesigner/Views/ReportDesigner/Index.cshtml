

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewBag.Title</title>
    <link href="https://cdn.boldreports.com/2.3.26/content/material/bold.reports.all.min.css" rel="stylesheet" />
    <link href="https://cdn.boldreports.com/2.3.26/content/material/bold.reportdesigner.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.37.0/codemirror.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.37.0/addon/hint/show-hint.min.css" rel="stylesheet" />
    <script src="https://cdn.boldreports.com/external/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="https://cdn.boldreports.com/external/jsrender.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.37.0/codemirror.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.37.0/addon/hint/show-hint.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.37.0/addon/hint/sql-hint.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.37.0/mode/sql/sql.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.44.0/mode/vb/vb.min.js" type="text/javascript"></script>
    <!--Used to render the gauge item. Add this script only if your report contains the gauge report item. -->
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/ej2-base.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/ej2-data.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/ej2-pdf-export.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/ej2-svg-base.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/data-visualization/ej2-lineargauge.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/data-visualization/ej2-circulargauge.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/bold.reports.common.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/bold.reports.widgets.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/common/bold.report-designer-widgets.min.js"></script>
    <!--Used to render the chart item. Add this script only if your report contains the chart report item.-->
    <script src="https://cdn.boldreports.com/2.3.26/scripts/data-visualization/ej.chart.min.js"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/bold.report-viewer.min.js" type="text/javascript"></script>
    <script src="https://cdn.boldreports.com/2.3.26/scripts/bold.report-designer.min.js" type="text/javascript"></script>
    <script src="~/Scripts/extension/extension.config.js"></script>
    <script src="~/Scripts/extension/webapi.data.js"></script>
    <script src="~/Scripts/extension/queryinputdialog.js"></script>
</head>
<body>
    <div style="width:100%; height:100%; position:absolute;">
        <input type="button" id="Save" value="Save Report" />
        @{Html.Bold().ReportDesigner("designer").ServiceUrl("/api/DesignerAPI").ReportDataExtensions(ext => { ext.ClassName("WebAPIDataSource").Name("WebAPI").ImageClass("e-reportdesigner-datasource-webapi").DisplayName("WebAPI").Add(); }).Create("controlInitialized").Render();}
    </div>
    @(Html.Bold().ScriptManager())

    <script type="text/javascript">
            var qryOptions = null;
            var webApiQueryDialog = null;
            if (ej.isNullOrUndefined(webApiQueryDialog)) {
                webApiQueryDialog = new QueryInputDialog($('#designer'));
            }
            if (!ej.isNullOrUndefined(webApiQueryDialog)) {
                qryOptions = {
                    toolbarRendering: $.proxy(webApiQueryDialog.renderToolbarItems, webApiQueryDialog),
                    datasetLoaded: $.proxy(webApiQueryDialog.enableButton, webApiQueryDialog),
                    dataModeChanged: $.proxy(webApiQueryDialog.enableButton, webApiQueryDialog)
                };
            }
            function controlInitialized(args) {
                debugger;
            var designer = $("#designer").data('boldReportDesigner');
                designer.setModel({queryDesignerOptions: qryOptions });
            designer.model.queryDesignerOptions = qryOptions;
        }

        $(document).ready(function () {
            $("#Save").click(function () {
                debugger;
                var designerObj = $("#designer").data("boldReportDesigner");
                designerObj.saveReportDefinition((any) => { saveXMLData(any) }, ej.ReportDesigner.DataFormat.XML);
            });
        });  

        function saveXMLData(XmlData) {
            debugger;
           
            $.ajax({
                url: 'http://localhost:51897/api/DesignerAPI/GetByteArray',
                type: 'POST',
                contentType: 'text/xml',
                data: XmlData,
                success: function (data, textStatus, xhr) {
                    alert("save button");
                },
                error: function (xhr, textStatus, errorThrown) {
                    alert('Error in Operation');
                }
            });
        }
    </script>

</body>
</html>
